# Octo Events

This project utilizes the following stack:

- Kotlin
- Apache Kafka
- Apache Camel
- Javalin
- Spring Boot
- Koin
- Exposed
- JUnit
- KoinTest
- Mockito
- Spek



## Pre-requisites

- JDK 8 installed
- Git installed
- Gradle installed
- ngrok installed and authenticated
- Ports *2181*, *9092*, *8080*, *8787* available
- PostgreSQL installed on port *5432* with database *postgres*, user *postgres* and password *postgres*
- Apache Kafka 2.2.0 downloaded and extracted (please refer to https://kafka.apache.org/quickstart)



## Instructions



### Starting Kafka

Open a new terminal window, change to the Kafka directory `kafka_2.12-2.2.0`.

Example:

```bash
cd $HOME/kafka_2.12-2.2.0
```

If using Linux, start ZooKeeper this way:

```bash
bin/zookeeper-server-start.sh config/zookeeper.properties
```

If using Windows, start ZooKeeper this way:

```bash
bin\windows\zookeeper-server-start.bat config\zookeeper.properties
```

Wait for the log message to continue:

```
INFO binding to port 0.0.0.0/0.0.0.0:2181
```

Open a new terminal window, change to the Kafka directory `kafka_2.12-2.2.0`.

If using Linux, start Kafka this way:

```
bin/kafka-server-start.sh config/server.properties
```

If using Windows, start Kafka this way:

```
bin\windows\kafka-server-start.bat config\server.properties
```

Wait for the log message to continue:

```
INFO [KafkaServer id=0] started (kafka.server.KafkaServer)
```

Open a new terminal window, change to the Kafka directory `kafka_2.12-2.2.0`.

If using Linux, create the topic `issue-event-topic` this way:

```
bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 --topic issue-event-topic
```

If using Windows, create the topic `issue-event-topic` this way:

```
bin\windows\kafka-topics.bat --create --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 --topic issue-event-topic
```

Wait for the return of the prompt to continue.

### Starting the microservices

Open a new terminal window, change to a working directory and clone the code from GitHub as follows:

```bash
git clone https://github.com/helderlee/octo-events.git
```

Enter to the octo-events directory:

```bash
cd octo-events
```

#### Starting the subscriber service

Enter to the octo-subscriber directory.

```bash
cd octo-subscriber
```

Build the octo-subscriber subproject:

```bash
gradle clean build
```

The tests will be executed. After that, run the octo-subscriber subproject:

```bash
gradle bootRun
```

Wait for the log message to continue:

```
Setting newly assigned partitions
```

At the first time, the log message below may appear after the log message above and you can continue:

```
Resetting offset for partition
```



#### Starting the producer service

Let octo-subscriber running and open a new terminal window. Change to the octo-events directory again. Enter to the octo-producer directory:

```bash
cd octo-producer
```

Build the octo-producer subproject:

```bash
gradle clean build
```

The tests will be executed. After that, run the octo-producer subproject:

```bash
gradle run
```

Wait for the log message to continue:

```
INFO  io.javalin.Javalin - Javalin has started \o/
```



#### Starting the query service

Let octo-subscriber running and open a new terminal window. Change to the octo-events directory again. Enter to the octo-query directory.

```bash
cd octo-query
```

Build the octo-query subproject:

```bash
gradle clean build
```

The tests will be executed. After that, run the octo-query subproject:

```bash
gradle run
```

Wait for the log message to continue:

```
INFO  io.javalin.Javalin - Javalin has started \o/
```



### Routing to localhost

Open a new terminal window, change to the ngrok directory. Expose the octo-producer publicly with ngrok:

```bash
ngrok http 8080
```

Copy the http forwarding URL generated by ngrok and enter any GitHub repository you own.

Click on *Settings* tab and then on *Webhooks* option in the menu.

Click on '*Add Webhook*' button. Enter your password if asked.

On '*Payload URL*' field, paste the http forwarding URL generated by ngrok and add */issues/events* to the URL:

```bash
http://********.ngrok.io/issues/events
```

Select '*application/json*' on field '*Content type*'.

On field '*Which events would you like to trigger this webhook?*', select '*Let me select individual events.*' option.

Uncheck the '*Pushes*' option.

Check the '*Issues*' option.

Make sure only '*Issues*' option is selected and click on '*Add webhook*' button.

Click on '*Issues*' tab to create a new issue.

Click on '*New issue*' button.

Type any title and any comment and click '*Submit new issue*' button.

Write down the issue number which is indicated with a # symbol.

Check the log on the ngrok terminal window.

Check the log on the octo-producer terminal window.

Check the log on the octo-subscriber terminal window.

Open a browser window and enter the following URL with the generated issue number:

```bash
http://localhost:8787/issues/<generated issue number>/events
```

Example:

```bash
http://localhost:8787/issues/1/events
```



It was fun!!!













